<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rare Grade Devs - Admin Sign In</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #020084, #0404d8);
      font-family: 'Fira Code', monospace;
      color: #f1f5f9;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid #93c5fd;
      border-top: 6px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .spinner-overlay, .alert-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,50,0.7);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">

  <!-- Spinner -->
  <div id="spinner-overlay" class="spinner-overlay flex">
    <div class="spinner"></div>
  </div>

  <!-- Alert Modal -->
  <div id="custom-alert" class="alert-modal flex">
    <div class="bg-blue-800 text-white p-6 rounded-lg shadow-lg w-[90%] max-w-sm text-center">
      <p id="alert-message" class="mb-4"></p>
      <button onclick="closeAlert()" class="bg-white text-blue-800 font-bold px-4 py-2 rounded-full border border-blue-800 hover:bg-gray-100">Close</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="bg-blue-900/60 p-8 rounded-2xl shadow-lg w-full max-w-md backdrop-blur">
    <div class="text-center mb-6">
      <img src="https://dashboard.raregradetech.com/uploads/company/b65f0e95c1b847586fb52cd9c734f19a.png" class="mx-auto w-20 mb-4" />
      <h1 class="text-2xl sm:text-3xl font-bold text-white">Rare Grade <span class="text-blue-300">Devs</span></h1>
      <p class="text-gray-300 text-sm mt-2">Admin Sign In</p>
    </div>
    <input type="email" id="email" placeholder="Email" class="w-full p-3 mb-4 rounded-lg bg-blue-800 text-white border border-blue-700 focus:outline-none focus:border-blue-300" />
    <input type="password" id="password" placeholder="Password" class="w-full p-3 mb-6 rounded-lg bg-blue-800 text-white border border-blue-700 focus:outline-none focus:border-blue-300" />
    <button onclick="signIn()" class="w-full bg-white text-blue-900 font-semibold py-3 rounded-full border border-blue-900 hover:bg-gray-100 transition">Sign In</button>
    <p class="text-gray-400 text-sm mt-4 text-center">Don't have an account? <a href="signup.html" class="text-blue-300 hover:underline">Sign Up</a></p>
  </div>

  <!-- Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.appspot.com",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    function showSpinner() {
      const spinner = document.getElementById('spinner-overlay');
      spinner.style.display = 'flex';
    }

    function hideSpinner() {
      const spinner = document.getElementById('spinner-overlay');
      spinner.style.display = 'none';
    }

    function showAlert(message) {
      document.getElementById('alert-message').textContent = message;
      document.getElementById('custom-alert').style.display = 'flex';
    }

    window.closeAlert = function () {
      document.getElementById('custom-alert').style.display = 'none';
    };

    async function checkAdmin(user) {
      const userRef = ref(db, `users/${user.uid}`);
      try {
        const snapshot = await get(userRef);
        const data = snapshot.val();
        console.log("User data:", data);
        if (data && data.isAdmin) {
          window.location.href = "admin.html";
        } else {
          showAlert("Access denied. Admin privileges required.");
          setTimeout(() => { window.location.href = "signup.html"; }, 3000);
        }
      } catch (err) {
        console.error("Error checking admin:", err);
        showAlert("Error verifying admin status.");
      } finally {
        hideSpinner();
      }
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        showSpinner();
        checkAdmin(user);
      }
    });

    window.signIn = async function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      if (!email || !password) {
        showAlert("Please fill in all fields.");
        return;
      }

      showSpinner();
      try {
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        checkAdmin(userCred.user); // handle in callback
      } catch (error) {
        console.error("Sign-in error:", error);
        showAlert(`Error: ${error.message}`);
        hideSpinner();
      }
    };
  </script>
</body>
</html>
